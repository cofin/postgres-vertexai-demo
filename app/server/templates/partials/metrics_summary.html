<!-- Total Searches -->
<div class="metric-card {{ 'success' if metrics.total_searches > 1000 else '' }}">
    <div class="metric-label">Total Searches <span class="help-icon" data-tippy-content="Total number of vector similarity searches performed using PostgreSQL's pgvector extension">?</span></div>
    <div class="metric-value">{{ "{:,}".format(metrics.total_searches) }}</div>
    <div class="metric-trend {{ 'trend-up' if metrics.searches_trend > 0 else 'trend-down' if metrics.searches_trend < 0 else 'trend-neutral' }}">
        {% if metrics.searches_trend > 0 %}
            â†‘ {{ metrics.searches_trend }}% from last hour
        {% elif metrics.searches_trend < 0 %}
            â†“ {{ metrics.searches_trend|abs }}% from last hour
        {% else %}
            â†’ No change
        {% endif %}
    </div>
    <div class="metric-tip">
        <span class="tip-icon" data-tippy-content="ðŸ’¡ Tip: High search volume indicates good user engagement. Consider scaling your PostgreSQL server resources if searches exceed 10,000/hour to maintain optimal performance.">ðŸ’¡</span>
    </div>
</div>

<!-- Average Response Time -->
<div class="metric-card {{ 'success' if metrics.avg_response_time < 100 else 'warning' if metrics.avg_response_time < 200 else 'danger' }}">
    <div class="metric-label">Avg Response Time <span class="help-icon" data-tippy-content="End-to-end response time including embedding generation, pgvector similarity search, and Google Vertex AI processing">?</span></div>
    <div class="metric-value">{{ "{:.0f}".format(metrics.avg_response_time) }}ms</div>
    <div class="metric-trend {{ 'trend-down' if metrics.response_time_trend < 0 else 'trend-up' if metrics.response_time_trend > 0 else 'trend-neutral' }}">
        {% if metrics.response_time_trend < 0 %}
            â†“ {{ metrics.response_time_trend|abs }}% faster
        {% elif metrics.response_time_trend > 0 %}
            â†‘ {{ metrics.response_time_trend }}% slower
        {% else %}
            â†’ Stable
        {% endif %}
    </div>
    <div class="metric-tip">
        <span class="tip-icon" data-tippy-content="ðŸ’¡ Tip: Response times > 200ms may indicate: 1) Missing pgvector indexes on your PostgreSQL tables, 2) Cold starts in Vertex AI, or 3) Network latency. Enable connection pooling and warm-up queries.">ðŸ’¡</span>
    </div>
</div>

<!-- PostgreSQL Vector Time -->
<div class="metric-card {{ 'success' if metrics.avg_db_time < 50 else 'warning' if metrics.avg_db_time < 100 else 'danger' }}">
    <div class="metric-label">PostgreSQL Vector Time <span class="help-icon" data-tippy-content="Time spent executing vector similarity searches using pgvector's HNSW indexes for approximate nearest neighbor search">?</span></div>
    <div class="metric-value">{{ "{:.0f}".format(metrics.avg_db_time) }}ms</div>
    <div class="metric-trend">
        <span style="color: #666;">{{ "{:.1f}".format(metrics.db_percentage) }}% of total time</span>
    </div>
    <div class="metric-tip">
        <span class="tip-icon" data-tippy-content="ðŸ’¡ Tip: pgvector search should be < 50ms with proper HNSW indexing. Use CREATE INDEX ON table USING hnsw (vector) for optimal performance on vector columns.">ðŸ’¡</span>
    </div>
</div>

<!-- Cache Hit Rate -->
<div class="metric-card {{ 'success' if metrics.cache_hit_rate > 80 else 'warning' if metrics.cache_hit_rate > 50 else 'danger' }}">
    <div class="metric-label">Cache Hit Rate <span class="help-icon" data-tippy-content="Percentage of requests served from PostgreSQL-based response cache, avoiding redundant vector searches and AI model calls">?</span></div>
    <div class="metric-value">{{ "{:.0f}".format(metrics.cache_hit_rate) }}%</div>
    <div class="metric-trend {{ 'trend-up' if metrics.cache_trend > 0 else 'trend-down' if metrics.cache_trend < 0 else 'trend-neutral' }}">
        {% if metrics.cache_trend > 0 %}
            â†‘ {{ metrics.cache_trend }}% improvement
        {% elif metrics.cache_trend < 0 %}
            â†“ {{ metrics.cache_trend|abs }}% decrease
        {% else %}
            â†’ Consistent
        {% endif %}
    </div>
    <div class="metric-tip">
        <span class="tip-icon" data-tippy-content="ðŸ’¡ Tip: Low cache hit rates (< 50%) suggest diverse queries. Consider: 1) Implementing semantic query clustering, 2) Increasing cache TTL for popular searches, 3) Pre-warming cache with common queries.">ðŸ’¡</span>
    </div>
</div>


<!-- User message -->
<div class="message user" data-message-id="{{ query_id }}">
    <strong>You:</strong> {{ user_message }}
</div>

<!-- AI response -->
<div class="message assistant" data-message-id="{{ query_id }}">
    <strong>AI Coffee Expert:</strong> <span class="ai-response-content">{{ ai_response }}</span>

    <!-- Help Triggers with Dynamic Data -->
    <div class="help-triggers" style="display: inline-flex; gap: 4px; margin-left: 8px; vertical-align: middle;">
        {% if debug_info.intent and debug_info.intent.intent %}
            <button type="button" class="help-trigger"
                    onclick="showTooltip('intent-detection', this)"
                    title="Intent: {{ debug_info.intent.intent }}"
                    data-debug-info='{{ debug_info }}'>
                &#127919; <!-- Target icon -->
            </button>
        {% endif %}

        {% if debug_info.search and debug_info.search.results_count > 0 %}
            <button type="button" class="help-trigger"
                    onclick="showTooltip('vector-search', this)"
                    title="Product Vector Search"
                    data-debug-info='{{ debug_info }}'>
                &#128270; <!-- Magnifying glass -->
            </button>
        {% endif %}

        {% if debug_info.cache_hit %}
            <button type="button" class="help-trigger cache-hit"
                    onclick="showTooltip('embedding-cache-hit', this)"
                    title="Embedding Cache Hit">
                &#129504; <!-- Brain icon -->
            </button>
        {% endif %}

        <button type="button" class="help-trigger"
                onclick="showTooltip('performance-summary', this)"
                title="See Performance"
                data-debug-info='{{ debug_info }}'>
            &#128202; <!-- Chart icon -->
        </button>
    </div>
</div>

<!-- Performance metrics update -->
{% if query_id %}
<script>
    // Update metrics after each response
    setTimeout(() => {
        if (typeof loadMetrics === 'function') {
            loadMetrics();
        }
    }, 1000);
</script>
{% endif %}
